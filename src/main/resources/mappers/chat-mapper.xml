<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- chatRoom-mapper.xml -->
<mapper namespace="chat">
	<!-- 채팅 조회 -->
	<select id="chatListByRoom" resultType="com.wit.dto.ChatDTO">
		select * from chat c
		join employee emp
		on c.name = emp.emp_no
		where c.chat_room_seq = #{chat_room_seq} order by c.chat_seq asc
	</select>
	
	<!-- 채팅 입력 -->
	<insert id="insertChat">
		insert into chat(chat_seq, chat_room_seq, name, sender, message, send_time) values(chat_seq.NEXTVAL, #{chat_room_seq}, #{name}, #{sender}, #{message}, SYSDATE)
	</insert>
	
	<!-- 채팅 읽었는지 확인 -->
	<update id="markMessagesAsRead">
	    UPDATE chat_read_status
	    SET last_read_message_seq = (
	        SELECT MAX(chat_seq) FROM chat WHERE chat_room_seq = #{chatRoomSeq}
	    )
	    WHERE chat_room_seq = #{chatRoomSeq}
	    AND emp_no = #{empNo}
	</update>
</mapper>
